<?php
function savePostData($name)
{
    if (!empty($_POST)) {
        $custom_config = array();
        if (!empty($_POST[$name])) {
            foreach ($_POST[$name] as $g) {
                $g = array_map('trim', $g);
                if (!empty($g['f'])) {
                    $custom_config[$g['f']] = $g['v'];
                }
            }

            if (!empty($custom_config)) {
                setcookie("__api_{$name}_params__", json_encode($custom_config), time() + 86400000, '/');
            }
        }
    } elseif (!empty($_COOKIE["__api_{$name}_params__"])) {
        $custom_config = json_decode($_COOKIE["__api_{$name}_params__"], true);
    } else {
        $custom_config = array();
    }

    $config_data = array();
    if (file_exists(".{$name}.json")) {
        $config_data = json_decode(file_get_contents(".{$name}.json"), true);
        foreach ($config_data as &$g) {
            if (isset($custom_config[$g['f']])) {
                $g['v'] = $custom_config[$g['f']];
            }
        }
    }

    return $config_data;
}

function formParams($data, $name = 'global')
{
    if (!empty($data)) {
        foreach ($data as $k => $d) {
            ?>
            <div class="form-group">
                <div class="col-sm-3">
                    <input type="hidden" name="<?php echo $name ?>[<?php echo $k ?>][f]" value="<?php echo $d['f'] ?>">
                    <label for="" class="form-control-static"><?php echo $d['f'] ?></label>
                </div>
                <div class="col-sm-6">
                    <input type="text" class="form-control" name="<?php echo $name ?>[<?php echo $k ?>][v]"
                           value="<?php echo $d['v'] ?>" placeholder="å€¼">
                </div>
                <div class="col-sm-3 text-left form-control-static">
                    <?php echo $d['t'] ?>
                </div>
            </div>
            <?php
        }
    }
}

function globalParamsInput($global_config)
{
    if (!empty($global_config)) {
        foreach ($global_config as $k => $global) {
            ?>
            <tr>
                <td>
                    <div class="form-control-static">
                        <?php echo $global['f'] ?>
                    </div>
                </td>
                <td>
	                <div class="form-group col-lg-12">
	                    <input type="text" class="form-control" required="1" name="<?php echo $global['f'] ?>"
	                           value="<?php echo $global['v'] ?>"
	                           placeholder="<?php echo $global['f'] ?>">
	                    <span class="hidden-xs">
	                        <b style="form-control-static">*</b>
                        </span>
                    </div>
                </td>
                <td>
                    <div class="form-control-static">
                        <span class="visible-xs"><b style="form-control-static">*</b></span>
                        <span class="hidden-xs"><?php echo $global['t'] ?></span>
                    </div>
                </td>
            </tr>
            <?php
        }
    }
}

$global_config = savePostData('global');
$header_config = savePostData('header');
?>
